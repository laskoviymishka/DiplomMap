@model DataAccess.Model.Project

@{
	ViewBag.Title = "Create";
}
<head>

</head>

<h2>Новый проект</h2>
<script type="text/javascript">
	var map;
	function CheckAddress(e) {
		GMaps.geocode({
			address: $('#Address').val().trim(),
			callback: function (results, status) {
				if (status == 'OK') {
					var latlng = results[0].geometry.location;
					map.removeMarkers()
					map.setCenter(latlng.lat(), latlng.lng());
					map.setZoom(13);
					map.addMarker({
						lat: latlng.lat(),
						lng: latlng.lng()
					});
					document.getElementById('Lat').value = latlng.lat().toString().replace('.', ',');
					document.getElementById('Lng').value = latlng.lng().toString().replace('.', ',');
				}
			}
		});
	};

	$(document).ready(function () {
		map = new GMaps({
			el: '#map',
			lat: 53.6,
			lng: 30.623333,
			zoom: 8
		});

		GMaps.on('click', map.map, function (event) {
			var index = map.markers.length;
			var lat = event.latLng.lat();
			var lng = event.latLng.lng();
			map.removeMarkers()
			map.setCenter(lat, lng);
			map.addMarker({
				lat: lat,
				lng: lng
			});
			document.getElementById('Lat').value = lat.replace('.', ',');
			document.getElementById('Lng').value = lng.replace('.', ',');
			document.getElementById('Address').value = 'Нет адреса'
		});
	});
</script>

@using (Html.BeginForm())
{
	@Html.AntiForgeryToken()
	@Html.ValidationSummary(true)

	<fieldset>
		<legend>Project</legend>

		<div class="editor-label">
			@Html.LabelFor(model => model.Name)
		</div>
		<div class="editor-field">
			@Html.EditorFor(model => model.Name)
			@Html.ValidationMessageFor(model => model.Name)
		</div>

		<div class="editor-label">
			@Html.LabelFor(model => model.Description)
		</div>
		<div class="editor-field">
			@Html.EditorFor(model => model.Description)
			@Html.ValidationMessageFor(model => model.Description)
		</div>

		<div class="editor-label">
			@Html.LabelFor(model => model.CategoryID, "InvestCategory")
		</div>
		<div class="editor-field">
			@Html.DropDownList("CategoryID", (SelectList)ViewBag.CategoryID)
			@Html.ValidationMessageFor(model => model.CategoryID)
		</div>

		<div class="editor-label">
			@Html.LabelFor(model => model.Region, "RegionNav")
		</div>
		<div class="editor-field">
			@Html.DropDownList("Region", (SelectList)ViewBag.Region)
			@Html.ValidationMessageFor(model => model.Region)
		</div>

		<div class="editor-label">
			@Html.LabelFor(model => model.Address)
		</div>
		<div class="editor-field">
			@Html.EditorFor(model => model.Address)
			@Html.ValidationMessageFor(model => model.Address)
			<span class="btn" onclick="CheckAddress()">Проверить адресс</span>
		</div>

		<div class="editor-label">
			@Html.LabelFor(model => model.Lat)
		</div>
		<div class="editor-field">
			@Html.EditorFor(model => model.Lat)
			@Html.ValidationMessageFor(model => model.Lat)
		</div>

		<div class="editor-label">
			@Html.LabelFor(model => model.Lng)
		</div>
		<div class="editor-field">
			@Html.EditorFor(model => model.Lng)
			@Html.ValidationMessageFor(model => model.Lng)
		</div>

		<p>
			<input type="submit" value="Create" />
		</p>
	</fieldset>
}
<div class="row">
	<div class="span11">

		<div style="height:550px">
			<div id="map" style="height:100%"></div>
		</div>
	</div>
</div>
<div>
	@Html.ActionLink("Back to List", "Index")
</div>

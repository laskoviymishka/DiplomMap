@model IEnumerable<Invest.Common.Model.Common.Region>
@{
    ViewBag.Title = "Index";
    int idIndex = 0;
}
<link href="../../Content/jquery.dataTables.css" rel="stylesheet" type="text/css" />
<link href="../../Content/demo_table.css" rel="stylesheet" type="text/css" />
<link href="../../Content/demo_page.css" rel="stylesheet" type="text/css" />
<script src="../../Content/jquery.dataTables.min.js" type="text/javascript"></script>
<script>
    $(document).ready(function () {
        $('#main-table').dataTable({
            sPaginationType: 'full_numbers',
            oSearch: { sSearch: "Могилев" }
        });
    });
</script>
<table id="main-table" class="table table-striped table-condensed">
    <thead>
        <th>
            Регион
        </th>
        <th>
            Латинское название
        </th>
        <th>
            Агрегирующий параметр
        </th>
        @for (int i = ViewBag.StartYear; i <= ViewBag.EndYear; i++)
        {
            <th>
                @i год
            </th>
        }
        <th>
            Динамика параметра параметр
        </th>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            foreach (var inner in item.Parametrs)
            {
                foreach (var child in inner.ChildParametrs)
                {
                    <tr>
                        <td>
                            @Html.ActionLink(item.RegionName, "RegionParametr/" + item._id, "Region")
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.EnglishName)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => inner.ParametrName)
                        </td>
                        @for (int i = ViewBag.StartYear; i <= ViewBag.EndYear; i++)
                        {
                            <th>
                                <p>@child.Values.FirstOrDefault(c => c.Key == i).Value</p>
                            </th>
                        }
                        <td>
                            <div>
                                @{idIndex++;}
                                <div>
                                    <button onclick="ShowEdit('@string.Format("/Region/ChildParametr/{0}/{1}", item._id, child.ParametrName.GetHashCode())',@idIndex)" class="btn" style="margin:3px;">@child.ParametrName</button>
                                </div>
                                <div id="@idIndex" style="margin:3px; width:100%; display:none">
                                </div>
                            </div>
                        </td>
                    </tr>
                }
            }
        }
    </tbody>
</table>
<script type="text/javascript">
    ShowEdit = function (link, idindex) {
        var index = '#' + idindex;
        $.get(link, function (data) {
            $(index).html(data);
            $(index).toggle('roll');
        });
    }
</script>

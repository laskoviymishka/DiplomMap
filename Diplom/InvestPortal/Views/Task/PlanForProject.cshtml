@using Invest.Common.Model.ProjectModels
@using Invest.Common.State
@using InvestPortal.Models
@model Project
@{
    ViewBag.Title = "Дорожная карта проекта " + Model.Name;
}
<h2>Дорожная карта проекта @Model.Name</h2>
@if (Model.Tasks != null && Model.Tasks.Any())
{
    foreach (var task in Model.Tasks.Where(t => (!t.IsComplete && !t.IsVerifiedComplete)))
    {
        <div class="list-group" onclick="addSubTask('@task._id','@task.ProjectId')">
            @{Html.RenderAction("RecursiveTaskPartial", "Task", new { taskId = task._id, projectId = task.ProjectId });}
        </div>
    }
}
@if (Model.WorkflowState.CurrenState == ProjectStates.WaitForPlan || Model.WorkflowState.CurrenState == ProjectStates.PlanRealiztion || Model.WorkflowState.CurrenState == ProjectStates.WaitForDefectPlan)
{
    <input type="button" value="Добавить ключевую точку" onclick=" addCoreTask() " />
    <script type="text/javascript">
        function addCoreTask() {
            var link = '/Task/CreateSubTask/@Model._id/@Model._id';
            $.get(link, function (data) {
                $('#test').html(data);
                $('#test').show();
            });
        }

        function addSubTask(parentId, projectId) {
            var link = '/Task/CreateSubTask/' + parentId + '/' + projectId;
            $.get(link, function (data) {
                $('#test').html(data);
                $('#test').show();
            });
        }
    </script>
    <div id="test">
    </div>

    <div style="margin:20px">
        @Html.ActionLink("Потвердить созданный план", "CompleteFill", new { projectId = Model._id }, new { @class = "button success" })
    </div>
}

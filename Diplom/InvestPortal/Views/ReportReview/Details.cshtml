@using Invest.Common.Model.Common
@model Invest.Common.Model.ProjectModels.Task
@{
    ViewBag.Title = "Details";
}
<h2>
    Details
</h2>
<fieldset>
    <legend>Задание</legend>
    <small class="display-label">
        @Html.DisplayNameFor(model => model.Title)
    </small>
    <blockquote class="display-field">
        @Html.DisplayFor(model => model.Title)
    </blockquote>
    <small class="display-label">
        @Html.DisplayNameFor(model => model.Description)
    </small>
    <blockquote class="display-field">
        @Html.Raw(HttpUtility.HtmlDecode(Model.Description))
    </blockquote>
    <small class="display-label">
        @Html.DisplayNameFor(model => model.Milestone)
    </small>
    <blockquote class="display-field">
        @Html.DisplayFor(model => model.Milestone)
    </blockquote>
    <small class="display-label">
        @Html.DisplayNameFor(model => model.CompletedOn)
    </small>
    <blockquote class="display-field">
        @Html.DisplayFor(model => model.CompletedOn)
    </blockquote>
    <small class="display-label">
        @Html.DisplayNameFor(model => model.IsComplete)
    </small>
    <blockquote class="display-field">
        @Html.DisplayFor(model => model.IsComplete)
    </blockquote>
    <small class="display-label">
        @Html.DisplayNameFor(model => model.IsVerifiedComplete)
    </small>
    <blockquote class="display-field">
        @Html.DisplayFor(model => model.IsVerifiedComplete)
    </blockquote>
    <small class="display-label">
        @Html.DisplayNameFor(model => model.IsLate)
    </small>
    <blockquote class="display-field">
        @Html.DisplayFor(model => model.IsLate)
    </blockquote>
    <fieldset style="margin-left:20px">
        <legend>Отчеты</legend>
        @if (Model.Reports != null)
        {
            foreach (var item in Model.Reports.Where(t => t.IsVisible))
            {
                <fieldset style="margin-left:20px">
                    <legend>Отчет от @item.ReportTime.ToShortDateString()</legend>
                    <small class="display-label">
                        @Html.DisplayNameFor(model => item.Body)
                    </small>
                    <blockquote class="display-field">
                        @Html.Raw(HttpUtility.HtmlDecode(item.Body))
                    </blockquote>
                    <div class="display-label">
                        Приложения
                    </div>
                    <ul>
                        <blockquote style="margin:10px">
                            @if (item.Appendix != null && item.Appendix.Any())
                            {
                                foreach (var appendix in item.Appendix)
                                {
                                    <li>
                                        @Html.ActionLink("Скачать " + appendix.InfoName,
                                              "Download",
                                               new { messageId = Model._id, appendixId = item._id }, new { @class = "button button info" })
                                    </li>
                                }
                            }
                        </blockquote>
                    </ul>
                    <fieldset style="margin-left:20px;">
                        <legend>Ответ на отчет</legend>
                        @if (item.Response != null)
                        {
                            <small class="display-label">
                                @Html.DisplayNameFor(model => item.Response.ResponseUser)
                            </small>
                            <blockquote class="display-field">
                                @Html.DisplayFor(model => item.Response.ResponseUser)
                            </blockquote>
                            <small class="display-label">
                                @Html.DisplayNameFor(model => item.Response.ResponseBody)
                            </small>
                            <blockquote class="display-field">
                                @Html.DisplayFor(model => item.Response.ResponseBody)
                            </blockquote>
                            <small class="display-label">
                                @Html.DisplayNameFor(model => item.Response.IsApproved)
                            </small>
                            <blockquote class="display-field">
                                @Html.DisplayFor(model => item.Response.IsApproved)
                            </blockquote>
                        }
                        else
                        {
                            <div class="display-field">
                                <strong>Отчет еще не проверен</strong>
                            </div>
                        }
                    </fieldset>
                </fieldset>
            }
        }
    </fieldset>
</fieldset>
<p>
    @Html.ActionLink("К списку отчетов", "Index")
</p>

@using Invest.Common.Model.Common
@model Invest.Common.Model.ProjectModels.Task
@{
    ViewBag.Title = "О задании";
}
<h2>
    Подробнее о задании
</h2>
<div>
    @Html.ActionLink("К списку отчетов", "Index", null, new { @class = "icon-arrow-left-3 fg-darker big" })
</div>
<fieldset>
    <legend>Задание</legend>
    <small class="display-label">
        @Html.DisplayNameFor(model => model.Title)
    </small>
    <blockquote class="display-field">
        @Html.DisplayFor(model => model.Title)
    </blockquote>
    <small class="display-label">
        @Html.DisplayNameFor(model => model.Description)
    </small>
    <blockquote class="display-field">
        @Html.Raw(HttpUtility.HtmlDecode(Model.Description))
    </blockquote>
    <small class="display-label">
        @Html.DisplayNameFor(model => model.Milestone)
    </small>
    <blockquote class="display-field">
        @Html.DisplayFor(model => model.Milestone)
    </blockquote>
    @if (Model.IsComplete)
    {
        <small class="display-label">
            @Html.DisplayNameFor(model => model.CompletedOn)
        </small>
        <blockquote class="display-field">
            @Html.DisplayFor(model => model.CompletedOn)
        </blockquote>
    }
    <small class="display-label">
        @Html.DisplayNameFor(model => model.IsLate)
    </small>
    <blockquote class="display-field">
        @Html.DisplayFor(model => model.IsLate)
    </blockquote>
    <fieldset style="margin:20px">
        <legend>Отчеты</legend>
        @if (Model.Reports != null && Model.Reports.Any(t => t.IsVisible))
        {
            foreach (var item in Model.Reports.Where(t => t.IsVisible))
            {
                <fieldset style="margin:20px">
                    <legend>Отчет от @item.ReportTime.ToShortDateString()</legend>
                    <small class="display-label">
                        @Html.DisplayNameFor(model => item.Body)
                    </small>
                    <blockquote class="display-field">
                        @Html.Raw(HttpUtility.HtmlDecode(item.Body))
                    </blockquote>
                    <small class="display-label">
                        Приложения
                    </small>
                    <ul>
                        <blockquote style="margin:10px">
                            @if (item.Appendix != null && item.Appendix.Any())
                            {
                                foreach (var appendix in item.Appendix)
                                {
                                    <li>
                                        @Html.ActionLink("Скачать " + appendix.InfoName,
                                              "Download",
                                               new { messageId = Model._id, appendixId = item._id }, new { @class = "button button info" })
                                    </li>
                                }
                            }
                        </blockquote>
                    </ul>
                    <fieldset style="margin:20px">
                        <legend>Ответ на отчет</legend>
                        @if (item.ReportResponse != null)
                        {
                            <small class="display-label">
                                @Html.DisplayNameFor(model => item.ReportResponse.ReportResponseUser)
                            </small>
                            <blockquote class="display-field">
                                @Html.DisplayFor(model => item.ReportResponse.ReportResponseUser)
                            </blockquote>
                            <small class="display-label">
                                @Html.DisplayNameFor(model => item.ReportResponse.ReportResponseBody)
                            </small>
                            <blockquote class="display-field">
                                @Html.DisplayFor(model => item.ReportResponse.ReportResponseBody)
                            </blockquote>
                            <small class="display-label">
                                @Html.DisplayNameFor(model => item.ReportResponse.IsApproved)
                            </small>
                            <blockquote class="display-field">
                                @Html.DisplayFor(model => item.ReportResponse.IsApproved)
                            </blockquote>
                            <blockquote style="margin:10px">
                                @if (item.ReportResponse.Appendix != null && item.ReportResponse.Appendix.Any())
                                {
                                    foreach (var appendix in item.ReportResponse.Appendix)
                                    {
                                        <li>
                                            @Html.ActionLink("Скачать " + appendix.InfoName,
                                              "Download",
                                               new { messageId = Model._id, appendixId = item.ReportResponse._id }, new { @class = "button button info" })
                                        </li>
                                    }
                                }
                            </blockquote>
                        }
                        else
                        {
                            <div class="display-field">
                                <strong>Отчет еще не проверен</strong>
                            </div>
                        }
                    </fieldset>
                </fieldset>
            }
        }
    </fieldset>
</fieldset>
